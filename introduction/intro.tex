\chapter{Introduction}
\label{chap:intro}
\section{Introduction}
This chapter provides a general introduction to the contextual background of the work presented in this thesis. First, we provide a general overview of the physical phenomena of fluorescence and F\"{o}rster resonance energy transfer (FRET). We describe the application of these phenomena to the study of biological molecules and the common experimental and analytical techniques used in these research areas. We then present an overview of techniques of statistical analysis, with a particular focus on model-based Bayesain inference. We present common sampling-based techniques for Bayesian statistical analysis and describe why Bayesian inference is a useful tool in the analysis of single-molecule fluorescence data.

\section{Fluorescence and FRET}
Since FRET was first used to measure the distance between two fluorescent dyes on individual molecules bound to a surface~\cite{ha96}, single-molecule FRET (smFRET) has become a popular tool to investigate the structure and dynamics of biomolecules, both on a surface and diffusing freely in solution~\cite{haran03, schuler02, weiss00}. We open this chapter with a discussion of the physical basis of molecular fluorescence and FRET. We then describe some of the applications of fluorescence in biological research, and describe the constraints and experimental techniques commonly used in single molecule fluorescence microscopy.

\subsection{The Physical Basis of Fluorescence}
\paragraph{Fluorescence}
Fluorescence is the physical phenomenon by which a molecule that has absorbed a photon of electromagnetic radiation and which is in an excited state relaxes via non-radiative processes, such as vibrational interactions, rotation and translation in its medium and then  emits a photon, returning to its ground state. Owing to the intramolecular transitions occurring prior to emission, the photon emitted is of a lower energy than the photon absorbed. The difference in energy between the absorbed and emitted photons is termed the Stokes shift (Fig.~\ref{fig:jablonski} B,~\cite{Albani2011}) and is a characteristic of the energy levels available to the excited molecule. 

The typical timescale for a single fluorescence excitation-emission cycle is approximately $10^{-10} - 10^{-7}$ s. This timescale is dominated by the lifetime of the excited state, (typically $10^{-10} - 10^{-7}$ s); photon excitation and emission processes occur on a timescale that is several orders of magniude shorter (absorption $10^{-15}$ s, relaxation $10^{-12} - 10^{-10}$ s).
 
\paragraph{Competing Processes}
The fluorescence excitation-emission cycle involves transitions between the singlet ground state ($\text{S}_0$) and first excited state ($\text{S}_1$) of the fluorophore (Fig.~\ref{fig:jablonski}). However, other competing, non-radiative processes can occur. Internal conversion -- a non-radiative transition to a lower energy state of the same spin multiplicity -- is possible, although the large energy gap between the $\text{S}_1$ and $\text{S}_0$ states makes it much less frequent than the more accessible fluorescent pathway. A more significant competitor is inter-system crossing, involving a non-radiative transition from the first singlet excited state, $\text{S}_1$ to the first triplet excited state, $\text{T}_1$. Although forbidden by spin selection rules, inter-system crossing is facilitated by spin-orbit coupling, allowing it to compete with fluorescence (rate $10^{-10} - 10^{-8}$ s) as a relaxation pathway.

From the $\text{T}_1$ state there are several accessible pathways to the ground state ($\text{S}_0$). Phosphorescence is the radiative decay from $\text{T}_1$ to $\text{T}_0$; alternatively, a second inter-system crossing back to $\text{S}_1$, followed by delayed fluorescence emission to reach the $\text{S}_0$ state is more common. As the lifetime of the $\text{T}_1$ state is long (on the order of $10^{-6} - 1$ s), this can be observed as photoblinking.  

A third relaxation pathway from the $\text{T}_1$ state is photobleaching. If the fluorophore is in a solution containing dissolved oxygen, the $\text{T}_1$ state can interact with the triplet ground state of molecular oxygen, leading to de-excitation via triplet-triplet annihilation:

\begin{equation}
^3\text{T}_1 + ^3\text{O}_2 \longrightarrow ^1\text{S}_0 + ^3\text{O}_2
\label{eq:blinking1}
\end{equation} 

The resultant singlet oxygen can then irreversibly oxidise the fluorophore, leaving it unable to undergo further fluorescent excitation-emission cycles.   

%Intersystem crossing ($10^{-10} - 10^{-8}$ s) and internal conversion ($10^{-11} - 10^{-9}$ s) are slower processes.

One useful parameter for characterising a fluorophore is its quantum yield, $\phi_f$, the fraction of excited molecules that undergo photon emission to return to the ground state. It is defined as: 

\begin{equation}
\phi_f = \frac{k_f}{k_f + k_{nr}}
\label{eq:quantum_yield}
\end{equation}

where $k_f$ and $k_{nr}$ are the rates of fluorescence emission and non-radiative emission respectively. When all molecules in the excited state were promoted by photon absorption, $\phi_f$ can be equivalently defined as the fraction of absorption events that result in fluorescence emission: 


\begin{equation}
\phi_f = \frac{n_{\text{emitted}}}{n_{\text{absorbed}}}
\label{eq:quantum_yield_ratio}
\end{equation}

where $n_{\text{emitted}}$ and $n_{\text{absorbed}}$ are respectively the number of emitted and absorbed photons.

The energetic interconversions involved in fluorescence can be summarised using a Jablonski diagram (Fig.~\ref{fig:jablonski}).

\begin{figure}[!ht]
   \begin{center}
      %\includegraphics*[clip=true, width=5in]{jablonski.pdf}
      \caption{A) Jablonski diagram depicting the possible electronic processes undergone by an excited fluorophore. Solid lines indicate electronic transitions, wavy lines indicate vibrational transitions. IC = internal conversion, ISC = intersystem crossing. B) Characteristic times of the processes depicted in the Jablonski diagram. C. Due to fast vibrational relaxation, the fluorescence emission is shifter to longer wavelengths than the absorption (Stokes shift). Figure from~\cite{Horrocks2014}, used with permission.}
      \label{fig:jablonski}
   \end{center}
\end{figure}

\subsection{The Physical Basis of FRET}
\label{sect:fret}
\paragraph{F\"{o}rster Resonance Energy Transfer}
F\"{o}rster resonance energy transfer (FRET) is a non-radiative energy transfer process that can occur between chromophoric molecules~\cite{forster48}. The degree of energy transfer, E, is dependent on the fluorophore distance, varying inversely with the sixth power of the dye-dye distance, $r$: 

\begin{equation}
E = \frac{1}{1+ (\frac{r}{R_0})^6}
\label{eq:FRET_d}
\end{equation}

Here, $R_0$ is the F\"{o}rster distance, a dye-dependent constant that defines the dye-dye distance for which the energetic transfer efficiency is 50 \%. $R_0$ is defined, for a donor (D) and acceptor (A) fluorophore pair, by their degree of spectral overlap and their relative orientation:

\begin{equation}
R_0 = \sqrt[\leftroot{-2}\uproot{2}6]{\frac{9000\phi_D\ln(10)\kappa^2J(\lambda)}{128\pi^2n^4N_A}}
\label{eq:R_0}
\end{equation}

Here, $\phi_D$ is the quantum yield of the donor fluorophore, $\kappa$ is the dipole orientation factor, $N_A$ is Avogadro's number, n is the refractive index of the medium, and $J(\lambda)$ is the spectral overlap integral:

\begin{equation}
J(\lambda) = \int f_D(\lambda)\epsilon_A(\lambda)\lambda^4\,d\lambda
\label{eq:J}
\end{equation}

where $f_D(\lambda)$ and $\epsilon_A(\lambda)$ are respectively the normalised emission spectrum of the donor and the molar extinction coefficient of the acceptor at wavelength $\lambda$. The dipole orientation factor, $\kappa^2$ is typically assumed to be $\frac{2}{3}$, the value observed if both dyes are freely rotating and hence can be assumed to be isotropically oriented during the lifetime of the $\text{S}_1$ excited state~\cite{Demchenko2008}.

\paragraph{Deriving the FRET Equation}
The distance dependence of the energy transfer allows FRET to be used as a ``molecular ruler"~\cite{stryer67}, to determine intramolecular distances. For a given FRET enrgy transfer event, the FRET Efficiency, $E$, defined with respect to the intramolecular distance $r$ in Eq.~\ref{eq:FRET_d}, is given ratiometrically by:

\begin{equation}
E = \frac{n_A}{\gamma \cdot n_D + n_A}
\label{eq:FRET_E}
\end{equation}

where $n_A$ and $n_D$ are the number of observed photons emitted by the acceptor and donor fluorophores respectively, and $\gamma$ is an instrument-dependent constant that corrects for unequal detection efficiencies. The equivalence of Eq.~\ref{eq:FRET_d} and Eq.~\ref{eq:FRET_E} is derived below.

As defined above, the quantum yield of a (donor) fluorophore is given by the ratio of the rates of decay from the excited state $\text{S}_1$ via radiative and non-radiative processes: 

\begin{equation}
\phi_D = \frac{k_f}{k_f + k_{nr}}
\label{eq:quantum_yield_donor}
\end{equation}

Similar ratios can be used to describe the quantum yield of a donor fluorophore that can undergo FRET energy transfer (Eq.~\ref{eq:quantum_yield_donor_FRET}) and the FRET efficiency (Eq.~\ref{eq:FRET_ratio}):

\begin{equation}
\phi_{DA} = \frac{k_f}{k_f + k_{nr} + k_{ET}}
\label{eq:quantum_yield_donor_FRET}
\end{equation}

\begin{equation}
E = \frac{k_{ET}}{k_f + k_{nr} + k_{ET}}
\label{eq:FRET_ratio}
\end{equation}

where $k_{ET}$, the rate constant for the FRET energy transfer process, is given by:

\begin{equation}
k_{ET} = \frac{1}{t_D} \left(\frac{R_0}{r}\right)^6
\label{eq:k_ET}
\end{equation}

and $t_D$ is the lifetime of the excited state in the absence of an acceptor fluorophore: 

\begin{equation}
t_D = \frac{1}{k_{f} + k_{nr}}
\label{eq:ex_lifetime}
\end{equation}

Combining Equations~\ref{eq:quantum_yield_donor},~\ref{eq:quantum_yield_donor_FRET} and~\ref{eq:FRET_ratio} yields:

\begin{equation}
\begin{split}
E &= 1 - \frac{k_{f} + k_{nr}}{k_f + k_{nr} + k_{ET}} \\ 
&= 1 - \frac{\phi_{DA}}{\phi_{D}} \\
&= 1 - \frac{n_{DA}}{n_{D}}
\label{eq:FRET_ratio_2}
\end{split}
\end{equation}

where $n_{DA}$ and $n_D$ are respectively the number of observed photons emitted by the donor fluorophore in the presence and absence of a FRET acceptor at distance $r$.

In the presence of a FRET acceptor, it is not possible to directly observe $n_D$. However, this can be derived from the number of photons observed to be emitted by the acceptor fluorophore, $n_A$. The difference in the number of photons emitted by the donor in the presence and absence of the acceptor is $n_D - n_{DA}$. This is related to the number of photons emitted by the acceptor, $n_A$, as follows:

\begin{equation}
\frac{n_D - n_{DA}}{n_A} = \frac{\phi_D\eta_D}{\phi_A\eta_A}
\label{eq:ratio_FRET}
\end{equation}

where $\phi_D$ and $\phi_A$ are the quantum yields of the donor and acceptor fluorophores respectively, and $\eta_D$ and $\eta_A$ are the respective instrumental detection efficiencies of donor and acceptor photons.

If we call the ratio $\frac{\phi_D\eta_D}{\phi_A\eta_A}$ $\gamma$, Eq.~\ref{eq:ratio_FRET} can be re-arranged to give:

\begin{equation}
n_D = n_D - \frac{n_A}{\gamma}
\label{eq:get_gamma}
\end{equation}

Substituting this definition of $n_D$ back into Eq.~\ref{eq:FRET_ratio_2} yields the expected definition of E,~\ref{eq:FRET_E}, that allows the inter-fluorophore distance to be related to an experimentally observed ratio of donor and acceptor photons.

%\section{Fluorescence Microscopy}
\section{Single Molecule Fluorescence Microscopy}
Both fluorescence and FRET have found many applications in the study of biological systems. Fluorescence microscopy is a well-established field of research, which uses fluorescence emission to generate an image. Synthetic or naturally occurring fluorophores are conjugated to biomolecules of interest and then excited using monochromcatic light matched to the fluorophore's absorption spectrum. Photons emitted from the fluorophores are collected and used to gain information about the structures and associations of the labelled molecules. 

Advances in the fields of optical microscopy, fluorophore synthesis and data analysis have facilitated development of optical techniques that are sensitive enough to detect emission from individual fluorophores. This has created the field of single molecule fluorescence microscopy and the capacity to characterise the behaviour of individual biomolecules. The following section describes the benefits of single molecule fluorescence microscopy, introduces the main optical systems used for single molecule imgaing, and discusses the experimental and analytical challenges involved in a single molecule experiment. As the main experimental technique used in this thesis, we focus our discussion on single molecule confocal spectroscopy; however, for context, we include an overview of other single molecule fluorescent techniques.  

%Fluorescence can be used simply to gain information about cellular organisation and molecular localisations; for example by fluorescently labelling specific cellular structures with organic dyes and then imaging planes of the entire cell to identify  
\subsection{Techniques of Single Molecule Imaging}
The greatest challenge in single molecule microscopy is to be able to detect dim fluorescence emission from individual molecules against a background of photon emission from other sources, such as Raman scattering by solution molecules~\cite{???} and fluorescence emission from other nearby fluorescent molecules~\cite{???}. Consequently, a large amount of work has been done to maximise the signal-to-noise ratio (SNR) of fluorescent emission data. This ratio can be optimised from both ends; namely maximising the signal and minimising the background noise. Maximising the signal involves the development and selection of fluorophores that achieve many fluorescent emission cycles during an excitation event. This is discussed in Section~\ref{sect:fluorophores}. 

An effective way to minimize the background noise is to reduce the emission detection volume; as the number of photons detected from irrelevant species will be reduced with a smaller detection volume, whereas detection of photons from a single fluorophore of interest within the detection volume will be unaffected. Single molecule fluorescence techniques can hence be characterised based on their method of detection volume reduction: Wide-field techniques, including Epifluorescence Microscopy and Total Internal Fluorescence Microscopy (TIRFM) illuminate and collect data from a wide image plane with a large area but minimal the depth; by contrast confocal microscopy techniques attempt to collect data from the smallest detection volume possible -- a voxel of volume approximately 1 fL. These techniques and the optical geometry required for successful data collection, are summarized below. 

\paragraph{Epifluorescence Microscopy}
The simplest geometry for single molecule fluorescence detection is epifluorescence microscopy (Fig.~\ref{fig:epi}). In an epifluorescence microscope monochromatic, collimated light is focused into the back apperture of an objective lens with a high Numerical Aperture (N.A.). A large volume of the fluorescently labelled sample, which is placed above the objective, is illuminated; emitted photons are collected through the same objective. Fluorescence emission is separated from excitation light using various filters before being focused onto a charge coupled device (CCD) camera which generates a current at each pixel proportional to the intensity of incident light.

The principal advantage of epifluorescent illumination, in addition to its ease of set-up, is the large illumination area. The detection volume is typically seveal microns in diameter, allowing multiple emitters to be imaged at the same time and to be tracked across multiple image frames~\cite{???}. Howerver, because the depth of the illumination volume in epifluorescence microscopy is relatively large, the SNR is quite low: many molecules at different depths into the sample volume are illuminated, resulting in a large amount of out-of-focus fluorescence reaching the CCD camera. Consequently, although epifluorescence microscopes are the most commonly used variant of the fluorescence microscope, they are less useful for single molecule detection, as the SNR is too low to efficiently resolve fluorescence emission from individual molecules.

\paragraph{Total Internal Fluorescence Microscopy}
Total Internal Fluorescence Microscopy (TIRFM) (Fig.~\ref{fig:TIRF}) uses a similar optical geometry to epifluorescence microscopy: as in epifluorescence imaging, the sample is illuminated via the back port of an objective and fluorescence emission is collected via the same objective and focused onto a CCD camera. Howerver, TIRFM exploits the phenomenon of Total Internal Reflection (TIR) to reduce the depth of the illumination volume and hence increase the SNR.

TIR occurs when a light wave passing through a medium with refractive index $n_1$ meets a dielectric medium with refractive index $n_2 < n_1$ with an incident angle $\theta$, where $\theta > \theta_c$, the critical angle (Fig.~\ref{fig:TIR_angle}). Under these conditions, rather than some of the light being refracted at the boundary between the two media, all of the light is reflected internally. As a result of the TIR, an evanescent wave is generated at the boundary. This wave is propagated along the boundary, but decays exponentially with distance from the boundary. The distance that the wave penetrates beyond the boundary is dependent on the incident angle $\theta$, decreasing as $\theta$ increases. Hence, to minimise the detection volume and maximise the SNR, it is advantageous that $\theta$ exceeds $\theta_c$ by as much as possible. 

The critical angle, $\theta_c$ is determined using Snell's Law~\cite{???} using the ratio of the refractive indices $n_1$ and $n_2$:

\begin{equation}
\theta_c = \sin^{-1}\left(\frac{n_2}{n_1}\right)
\label{eq:snell}
\end{equation}

For a typical borosilicate coverslide ($n = 1.518$) in contact with water ($n = 1.33$), a TIRF angle of $61.2^{\circ}$ is required, enabling fluorescence excitation to be limited to a depth of $\sim 100$ nm. The narrow excitation depth of TIRFM allows all of the advantages of epifluorescence (specifically large excitation area and particle tracking), but increases the SNR sufficiently that fluorescence emission from individual molecules can be effectively resolved.

%\paragraph{Super-Resolution Microscopy}
\paragraph{Confocal Microscopy}
Confocal microscopy takes the reduction in excitation volume a further step, minimizing the detection volume in all dimensions and collecting fluorescence emission from a solution volume of $\sim 1$ fL. In confocal microscopy (Fig.~\ref{fig:confocal}), a collimated laser beam is focused through an infinity corrected objective with a high N.A. onto a diffraction limited spot (diameter $> 1 \mu$m) a few microns into the sample volume. Fluorescence emission from the sample is collected and recollimated by the same objective, passed through a dichroic mirror to remove reflected incident light and then directed through a small aperture pinhole (diameter $50 - 100 \mu$m) placed in the conjugate focal plane to remove out-of-focus fluorescence. The remaining photons are directed onto a Avalanche Photodiode (APD) detector, which can detect individual photons with nanosecond resolution. To enable detection of fluorescence from individual fluorescent molecules, analyte solutions are used at extremely low concentrations (typically $10 - 100$ pM), such that the probability of more than one molecule occupying the confocal volume simultaneously is extremely small. Single molecule confocal microscopy is typically used in this manner to image labelled molecules diffusing freely in solution~\cite{weiss00} or flowed rapidly through the exciting laser beam~\cite{horrocks2012}; however in conjunction with a moveable sample stage or movable laser mount, it can also be used to image surface-tethered molecules~\cite{???}. 

\paragraph{Fluorescence Correlation Spectroscopy}
Fluorescence Correlation Spectroscopy (FCS) is an extension of the Confocal method described above. In FCS, a higher concentration ($1 - 100$ nM) of analyte solution is used, such that multiple fluorophores occupy the confocal volume an any time. Temporal fluctuations in the detected fluorescence emission can be used to determine physical paramters of the analyte solution, such as molecular concentrations and diffusion constants. These are determined by fitting a fluorescence autocorrelation function (Eq.~\ref{eq:fcs}), 

\begin{equation}
G(\tau) = \frac{\langle \delta F(t) \cdot \delta F(t + \tau)\rangle}{\langle F(t)^2 \rangle}
\label{eq:fcs}
\end{equation}   

where  $F(t)$ and $\delta F(t)$ are the absolute fluorescence intensity and the fluctuation about the mean intensity at a time t, respectively, using a three-dimensional diffusion model corrected for photoblinking effects (Eq.~\ref{eq:diffusion}): 

\begin{equation}
G(\tau) = \left( 1 - T + T\exp(\frac{-\tau}{-\tau_T}) \right)\frac{1}{N}\left( \frac{1}{1 + \frac{\tau}{\tau_T}} \right)\left( \frac{1}{1 + (\frac{\omega}{z_0})^2}\frac{t}{\tau_D}\right)^{0.5}
\label{eq:diffusion}
\end{equation}   

Here, $N$ is the average number of molecules residing in the confocal volume, $\tau_D$ is the characteristic residence time of the molecules, $\omega$ is the beam-waist and $z_0$ is the length of the measurement volume. The term $\left( 1 - T + T\exp(\frac{-\tau}{-\tau_T}) \right)$ corrects for photoblinking caused by population of the triplet excited state; $T$ is the fraction of molecules occupying the triplet state and $\tau_T$ is the triplet state lifetime.

FCS is used in Fluorescent Cross Correlation Spectroscopy~\cite{???} to determine the stoichiometry of molecular complexes; it is also used to study chemical reaction processes such as protein aggregation~\cite{???} and to study the behaviour of fluorescently labelled molecules inside living cells~\cite{???}. 

\subsection{Fluorophores for Single Molecule Imaging}
\label{sect:fluorophores}
All of the techniques of single molecule fluorescent microscopy described thus far are reliant on the availability of fluorophores that are bright enough that emission from individual fluorophores can be detected against background noise.  This requires the fluorophores to undergo sufficient cycles of excitation and fluorescent emission that a large number of photons can be detected. Several factors affect the suitability of fluorophores for this purpose.

To maximise the number of excitation-emission cycles, a fluorophore should have a high quantum yield, to maximise the number of photons emitted for some number of absorbed photons. The lifetime of the excited state should also be short, to increase the number of excitation-emission cycles per unit time. Furthermore, the fluorophore should have a high extinction coefficient at the excitation wavelength, to maximise the number of photon absorption events. Furthermore, the fluorophore should be resistant to both permanent photobleaching and to transient photoblinking, to prevent premature attenuation of fluorescence emission. These considerations are particularly pertinent for fluorophores used in confocal techniques, where the number of photons observed from each fluorophore is additionally limited by the dwell-time of the molecule in the confocal volume (typically less than 1 ms).

Considerable effort has been made to synthesize fluorophores that fulfil these requirements for the excitation wavelengths accessible to single molecule microscopy. Many of the most popular dyes are derived from fluorone (Fig.~\ref{fig:fluorone}): fluorescein, the fluorophore used in the first demonstration of single molecule detection~\cite{???} and the green-excited Rhodamine 6G are both built around fluorone's chromophoric heterocyclic structure; functionalised derivatives of these molecules form the basis of a range of blue- and green-excited fluorophores in the commercial Alexa Fluor and Atto ranges (Fig.~\ref{fig:dyes}). Red-excited fluorophores are typically derived from cyanine structures, although the polymethine backbone makes them susceptible to photobleaching via cis/trans isomerisation. To address this issue, conformationally locked derivatives, such as the commercially available Atto647N, have been developed; however both locked and unlocked cyanine derivatives are prone to photoblinking via population of long-lived triplet states~\cite{???}.

\section{Confocal Microscopy}
Thus far, we have given a general overview of the different applications of fluorescence in single molecule imaging. Howerver, this thesis primarily focuses on the analysis of data single molecule confocal microscopy. Hence, we shall now give a more detailed description of the challenges and experiemntal methodologies specific to this single molecule imaging technique.

\subsection{Data Acquisition and Analysis}
\paragraph{Single Molecule FRET}
The most common form of confocal single microscopy exploits the phenomenon of FRET (Section~\ref{sect:fret}) to determine intramolecular distances in a single molecule FRET (smFRET) experiment. In such an experiment, each molecule is site-specifically labelled with two fluorescent dyes, a donor ($D$) and an acceptor ($A$). The dyes are chosen such that the emission spectrum of the donor overlaps with the excitation spectrum of the acceptor, enabling FRET emission to occur when the two dyes are sufficiently close in space. 

A collimated laser beam, matched to the excitation spectrum of the donor, is used to illuminate an extremely dilute solution of these labelled molecules. When a labelled molecule diffuses through the laser beam, the fluorophore is excited and photons are emitted.  Emitted photons are collected, separated from excitation photons, recollimated, then further separated into donor and acceptor wavelengths using a dichroic mirror and directed onto two APD detectors for collection and analysis (Fig.~\ref{fig:fig1_instrumentation} A, B).

In the simplest smFRET experiment, all photons reaching the detectors during data acquisition binned as they are received into time-bins of length similar to the expected dwell-time of a molecule in the confocal volume. Fluorescent events are identified as the time-bins that contain sufficient photons to meet a specified criterion~\cite{weiss00}. Alternatively, to avoid missing or double counting fluorescent events that are split over more than one time-bin, photons can be binned a time-scale much shorter than the typical dwell time. A burst search algorithm~\cite{nir06} is then used to scan the resultant photon stream for bursts of a specified duration and brightness. Details of these two methods of event selection are provided in Chapter~\ref{chap:pyfret}.

Identified fluorescent events are then used to generate FRET histograms: the FRET efficiency of each event is calculated as described above:

\begin{equation}
E = \frac{n_A}{n_A + \gamma \cdot n_D}
\label{eq:Eprod}
\end{equation} 

Histograms of the observed FRET efficiencies (Fig.~\ref{fig:histogram}) can be fitted with gaussian distributions to calculate approximate intramolecular distances and to identify conformational sub-populations that might have been invisible to an ensemble-based technique~\cite{joo08, Walter2008}.

\paragraph{Direct Acceptor Excitation}
One drawback of the experimental technique summarized above is that the acceptor fluorophore can only be observed indirectly via FRET energy transfer from an excited donor fluorophore. Acceptor photobleaching and imperfect labelling of the analyte molecules can therefore lead to experimental artifacts such as the zero peak (Fig.~\ref{fig:zeropeak}), which complicate or distort downstream analysis. As a consequence, several experimental modifications of the simple FRET experiment have been developed to enable direct observation of the acceptor fluorophore.

One simple modification is Two Colour Coincidence Detection (TCCD)~\cite{orte06, orte10}. In this technique, two collimated, overlapped lasers are used to simultaneously excite both the donor and the acceptor fluorophores, enabling observation of the acceptor fluorophore even when the donor fluorophore is not present or when the inter-fluorophore distance is too great for FRET to occur. TCCD has been used in conjuction with simple FRET to study protein aggregation~\cite{cremades2012} and molecular conformation~\cite{Ye2012}.  

A more complex mmodification uses Alternating Laser Exciation (ALEX). In an ALEX experiment the diffusing molecules are excitated by two lasers in rapid alternation~\cite{kapanidis05}. One laser excites the donor fluorophore and the other can directly excite the acceptor fluorophore. The modulation is fast on the timescale of molecular dwell-time, allowing a single fluorescent molecule to receive multiple cycles of donor-acceptor direct excitation. The additional information obtained from direct excitation of the acceptor fluorophore allows fluorescent events originating from improperly labelled molecules to be excluded from further analysis. 

A further modification of this ALEX technique is Periodic Acceptor Excitation (PAX)~\cite{doose07}. PAX is a simplified version of ALEX, in which donor excitation is continuous, but there is rapid modulation of the acceptor excitation power. As in an ALEX experiment, this enables information about the molecular labelling state to be determined, however the experimental setup is simpler as rapid modulation is required for only one of the two lasers used.

\paragraph{Application to Oligomer Sizing}
As described above, a smFRET experiment is used to obtain information about intramolecular distances. However, single molecule confocal spectroscopy can also be applied to the problem of determining the size and stoichiometry of oligomeric species~\cite{orte10, cremades2012}. In these experiments, individual monomer molecules are labelled with a single fluorophore. Following some period of time during which the aggregation reaction proceeds, the reaction mixture is diluted to picomolar concentrations and subjected to TCCD illumination.  Oligomer size and stoichiometry is then calculated by comparing the brightness of observed fluorescent events with the brightness of a labelled monomer:

\begin{equation}
\text{Size} = 2 \cdot \left(\frac{n_D + \gamma^{-1}n_A}{\langle n_{\text{monomer}}\rangle}\right)
\label{eq:sizing}
\end{equation}

where $n_D$ and $n_A$ are the number of observed donor and acceptor photons, $\gamma$ is the instrumental gamma-factor described above and $\langle n_{\text{monomer}}\rangle$ the mean number of photons observed in fluoreoscence events from labelled monomeric species.

A further extension of this sizing technique uses microfluidic flow~\cite{horrocks12} combined with increased excitation intensities to increase the data collection rate. Automated dilution can also be used to rapidly dilute analyte solutions by up to six orders of magnitude~\cite{horrocks2013,}. This enables unstable mulitmeric complexes with weaker ($\mu$M) binding constants to be successfully analysed using smFRET before dissociation occurs.  


%For a single fluorescent burst, the FRET efficiency, $E$, can be calculated as (Eq~\ref{eq:Eprod}):

%\begin{equation}
%E = \frac{n_A}{n_A + \gamma \cdot n_D}
%\label{eq:Eprod}
%\end{equation} 

%for $n_A$ and $n_D$ detected acceptor and donor photons respectively and $\gamma$ an experimentally determined instrument-dependent correction factor. During the course of a smFRET experiment, several thousand fluorescent bursts are collected and used to construct FRET efficiency histograms. These histograms can be used to identify populations of fluorescent species~\cite{ha96}, typically by fitting multiple gaussian distributions.

%diluted to The emission spectrum of the donor dye ($D$) is chosen to overlap with the excitation spectrum of the acceptor ($A$). When the donor and acceptor are sufficiently close in space, exciting the donor dye results in FRET and fluorescent emission from the acceptor dye. The FRET efficiency, $E$, which describes the proportion of excitation energy transferred from the donor to the acceptor, depends on the distance, $r$ between the two dyes (Eq.~\ref{eq:efficiency}) and $R_0$, the F\"{o}rster distance, a dye dependent constant that describes the dye separation at which 50\% energy transfer is achieved (Fig.~\ref{fig:fig1_instrumentation} C)

%\begin{equation}
%E = \frac{1}{1 + (\frac{r}{R_0})^6} 
%\label{eq:efficiency}
%\end{equation}

%Consequently, the distance between the two fluorophores can be determined from the ratio of donor and acceptor photons emitted during an excitation event (Eq.~\ref{eq:Eprod}).

%\subsection{Data Analysis}
%\paragraph{Event Selection and Denoising}
%\paragraph{Information Gathering?}

%\subsection{Advantages over Ensemble Fluorescence Methods}
\subsection{Computational Challenges}
A confocal smFRET experiment, as described above, presents several computational challenges during data analysis. Based on an experimentally observed stream of observed photon counts, analysis should be able to determine many properties of the analyte and experiment, such as the number and concentration of fluorescent populations, the intramolecular distances between the dye attachment sites and, in an aggregation experiment, the stoichiometry of a multimeric complex. The following chapter (Chapter~\ref{chap:pyfret}) describes implementation of the most common methods for this form of data analsysis, involving deterministic event selection algorithms, simple subtraction based denoising, and the construction and fitting of FRET histograms to determine the number of fluorescent populations. Similar methods for oligomer sizing are briefly discussed in Chapter~\ref{chap:sizing}. 

However, as photon emission by fluorophores is inherently a probabilistic phenomenon, these problems are also well-posed as problems of probabilistic inference: given an observed sequence of fluorescent bursts, what are the most likely properties of the experimental system that generated that dataset. A considerable part of this thesis deals with the application of the tools of probabilistic analysis to the analysis of smFRET data, both to infer intramolecular distances (Chapter~\ref{chap:inference}) and to oligomer sizing (Chapter~\ref{chap:sizing}). Consequently, we now give a brief overview of the research discipline of Bayesian inference and outline the sampling techniques used in this work.  

%Firstly, it is necessary to be able to accurately identify fluorescent events and to separate them from noise photons. Secondly, where multiple fluorescent populations are present, they must be separated and their intramolecular distances determined. Finally, it is also necessary to be able to relate the 

%\paragraph{Improving the Signal}
%\paragraph{Accurate Event Selection}
%\paragraph{Accurate Distance Determination}

%\subsection{Advantages of Single Molecule Imaging}

%\section{Single Molecule Fluorescence Microscopy}
%\subsection{Overview}
%\subsection{Confocal Microscopy}

%\subsection{Total Internal Fluorescence Miroscopy}

%\subsection{Epifluorescent Microscopy}

%\subsection{Super-Resolution Microscopy}

\section{Probabilistic Inference and Bayesian Statistics}
This section introdeces the core concepts of probability theory and relates them to the analysis of smFRET datasets. We first introduce the concepts of model-based inference and Bayesian statistics. We then demonstrate how these concepts can be used to describe the physical processes underlying a smFRET experiment. We show that this describes a physical model of the smFRET experiment. Next, we introdue the sampling-based techniques that can be used to infer the parameters of these models in order to determine information from the experiments performed.   

\subsection{Probabily Theory}
\paragraph{Probabilty}
Probability theory is the study of stochastic processes and the mathematical functions, termed probability distributions, that describe them. In probability theory, a variable whose value is subject to chance variations is termed a random variable. A discrete random variable, such as the outcome of a die roll or a coin flip, can take one of a fixed number of values and is described by a probability mass function (PMF); a continuous random variable can take any of a continous range of values and is described by a probability density function (PDF). 

In the field of single molecule fluorescence, the number of photons emitted by a fluorophore undergoing continuous excitation can be described as a discrete random variable. It is discrete since the number of photons emitted must be integral: it is unphysical to consider fractions of a photon. Photon emission can therefore be modeled using a discrete probability distribution. The most common choice is the Poisson distribution~\cite{???}. The Poisson distribution, given by the below equation:

\begin{equation}
\Pr{X = x} = \frac{\lambda^x \cdot e^{-\lambda}}{x!}
\label{eq:poisson}
\end{equation}
 
for integer values of $x$, describes the probability of a given number of events occurring in a fixed time interval, so is a good model for photon emission. 


%The canonical example is the outcome of an experiment in which a fair, six-sided die is rolled once. If we term the final value shown on the die $X$, we can describe the probability distribution over possible values of $X$ as follows:

%\begin{equation}
%\Pr(X = x) = \frac{1}{6}, x = 1, 2, ... , 6 
%\label{eq:prob_die}
%\end{equation}  
\paragraph{Conditional Probability and Bayes Theorem}
Conditional probability is the probability that some event occurs, conditioned on the value of some other observation. From set theory, the conditional probability of event A, given event B, written $\Pr(A \mid B)$, is given by: 

\begin{equation}
\Pr(A \mid B) = \frac{\Pr(A \cup B)}{\Pr(B)}
\label{eq:conditional}
\end{equation}

This can be simply rearranged to give an expression for the probability of both events A and B occurring:

\begin{equation}
\Pr(A \cup B) = \Pr(A \mid B) \cdot \Pr(B) 
\label{eq:conditional_and}
\end{equation}

An analagous expression can be derived from the probability of event B given event A:


\begin{equation}
\Pr(A \cup B) = \Pr(B \mid A) \cdot \Pr(A) 
\label{eq:conditional_and}
\end{equation}

A simple substitution and rearrangement allows the derivation of Bayes' theorem, which relates the conditional probability $\Pr(A \mid B)$ to the conditional probability $\Pr(B \mid A)$~\cite{barberBRML2012}:

\begin{equation}
\Pr(A \mid B) = \frac{\Pr(B \mid A) \cdot \Pr(A)}{\Pr(B)} 
\label{eq:bayes}
\end{equation}
 
\paragraph{Bayesian Statistics}
Bayes Theorem (Eq.~\ref{eq:bayes}) provides the basis for Bayesian inference -- a method of statistical hypothesis testing. In Bayesian inference, the conditional probability $\Pr(A \mid B)$ is interpreted as a hypothesis, or model, the likelihood of which is evaluated based on observational evidence. Rewriting Eq.~\ref{eq:bayes} as the probability of a specific, parametric, model given some experimental observations, 

\begin{equation}
\Pr(\text{model}|\text{data}) = \frac{\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})}{\Pr(\text{data})} = \frac{\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})}{\int_{\forall \text{parameter values}}\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})} 
\label{eq:bayes_model}
\end{equation}

we see that it is possible to use a forward, generative model of an observed dataset, $\Pr(\text{data}|\text{model})$, coupled with a prior, $\Pr(\text{model})$, that describes appropriate values for the model parameters, to infer the posterior probability, $\Pr(\text{model}|\text{data})$, of the model paramters~\cite{barberBRML2012}. This reltionship, which forms the basis of Bayesian statistics, allows model parameters to be inferred based on observed experimental evidence.

\subsection{Monte Carlo Sampling}
For an extremely simple model, it may be possible to compute the solution to Eq.~\ref{eq:bayes_model} exactly, by enumerating all possible states of the model. However, computing the normalisation factor in the denominator requires summing over all possible values of parameter of the model. Consequently, it quickly becomes computationally intractable either to derive an analytical expression for the denominator, or to compute it numerically. 

To overcome this issue, sampling methods have been developed, which allow estimation of the distribution of values taken by the model parameters. To estimate the distribution of parameter values, it is sufficient to draw parameter samples distributed proportionally to the posterior distribution, $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$~\cite{hastings70}. The mean, variance and quantiles of these samples can be used to estimate the parameter values.

Monte Carlo Markov chain (MCMC) algorithms are a class of algorithms that facilitate sampling from the posterior probability over the model parameters, $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$. A Markov chain is a memoryless random walk~\cite{Norris1998}, that transitions between different, enumerable, states in a manner that depends only on the state currently occupied. A Markov Chain Monte Carlo algorithm constructs a Markov chain that has as its equilibrium distribution the desired posterior distribution $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$, but which can be easily sampled from~\cite{Smith1993}. Running such a Markov chain for many thousands of iterations allows it to reach equilibrium; once this state has been reached, sampling further values with long inter-sample intervals is equivalent to drawing independent samples of the model parameter values, conditioned on the observed data, allowing inference of the distribution of parameter values. 

The following sections provide a brief overview of some of the most widely used MCMC algorithms.  

\paragraph{Metropolis Hastings Sampling}
The Metropolis-Hastings algorithm~\cite{hastings70}, an extension of the earlier Metropolis Algorithm~\cite{metropolis53}, is a sampling algorithm for approximating a probability distribution, $\Pr{x}$, by sampling from a distribution, $f(x)$ that is propoprtional to the probability density of $\Pr(x)$. As with all MCMC sampling methods, Metropolis-Hastings sampling iteratively samples parameter values such that, as more samples are made, the distribution $f(x)$ comes to approximate $\Pr(x)$ more and more closely. 

At each step of the Metropolis-Hastings algorithm, one of the model parameters, $x^i$ is selected at random and its value modified by a small amount. The probability density $f(x, x^i)$, which is proportional to $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$, is evaluated using both the old and the new value of the parameter $x^i$ and the new parameter value is accepted with probability proportional to the acceptance ratio $\alpha$, defined as~\cite{chib95, barberBRML2012}:

\begin{equation}
\alpha =  \frac{f(x, x^i_{\text{new}})}{f(x, x^i_{\text{old}})} \sim \frac{\Pr(\text{data}|\text{model}, x^i_{\text{new}}) \cdot \Pr(\text{model}, x^i_{\text{new}})}{\Pr(\text{data}|\text{model}, x^i_{\text{old}}) \cdot \Pr(\text{model}, x^i_{\text{old}})}
\label{eq:MH_alpha}
\end{equation}

$x^i_{\text{new}}$ is always accepted if it improves the probability that the observed dataset was generated by the model parameters including $x^i_{\text{new}}$; accepting $x^i_{\text{new}}$ with some probability even when it makes the models worse prevents the sampler from getting stuck in a local optimum. Sampling in this manner allows the Markov chain to converge towards a better estimates of the model parameter values, by sampling from high-density regions of $\Pr{x}$.

\paragraph{Gibbs Sampling}
Gibbs sampling is a MCMC algorithm that is, in its simplest implementation, closely related to the Metropolis-Hastings algorithm. In Gibbs sampling, starting from a parametric model with a random initialisation of all parameter values, the sampling algorithm cycles through each parameter and draws a new sample value from a probability distribution, $\pi(x)$, conditioned on the current values of all other parameters~\cite{Smith1993}:

\begin{equation}
x_i \sim \pi(x_i \mid x_0, \cdots, x_{i-1}, x_{i+1}, \cdots, x_n)
\label{eq:gibbs}
\end{equation} 

Multiple iterations of this cycle produces a Markov chain whose stationary distribution, as for other MCMC sampling techinques, is the the desired posterior distribution $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$~\cite{gelman1995}.

\paragraph{Slice Sampling}
A third method of MCMC sampling is slice sampling. Slice sampling samples approximates the value of a random variable by sampling points uniformly from the are under the curve of its probability distribution function and then storing the $x$-coordinates of the samples obtained~\cite{Neal2003}. To approximate a univariate random varaible distributed according to some distribution, $f(x)$, the slice sampling algorithm is initialised with a random value of $x$, $x_0$, for which $f(x_0) > 0$. An auxiliary variable, $y$ is then chosen by drawing from the uniform distribution $U(0, f(x_0))$. Drawing a horizontal line across the distribution $f(x)$ at the value $y$ defines a horizontal slice, above which $f(x) > y$. An interval $I = (x_L, x_R)$ is defined such that the horizontal slice lies within $I$ and a new value of x, $x_1$ is chosen by sampling uniformly from $I$. This defines a Markov chain that converges to a uniform distribution over the area under the curve of the desired probability distribution~\cite{Neal2003}. Extensions of the slice sampling procedure to infer the values of multiple parameters can be achieved either by applying the univariate sampling algorithm to each variable in turn; or by sampling directly from the multivariate distribution using hyperrectangles to define the sample space for uniform sampling~\cite{Neal2003}. 

\paragraph{Considerations for MCMC Sampling}
In order to obtain valid estimates of model parameters, several important aspects of the MCMC process must be considered. Firstly, to avoid perturbation of the stationary distribution away from the desired equilibrium distribution (namely the probability distribution $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$), it is necessary that the property of Detailed Balance is maintained~\cite{???}. Detailed Balance refers to the microscopic reversibility of the Markov chain, such that the probability of being in some state $x$ and transitioning to some other state $x'$ must be equal to the probability of being in state $x'$ and transitioning to state $x$:

\begin{equation}
\Pr(x)\cdot\Pr(x \rightarrow x') = \Pr(x')\cdot\Pr(x' \rightarrow x)
\label{eq:balance}
\end{equation}

This is a consideration of particular importance for both Metropolis-Hastings and Gibbs sampling, where it is important to select proposal distributions such that detailed balance is maintained.

Two further important considerations are the related concepts of burn-in and sample thinning. In MCMC sampling, the Markov chain is typically intialised with random values that result in a model that approximates very poorly the posterior distribution $\Pr(\text{data}|\text{model}) \cdot \Pr(\text{model})$. Hence, in sampling parameters using Markov chain sampling, it is necessary to run the sampler through many sampling iterations before beginning to store parameter estimates, in order to ensure that the initial values have been forgotten and the Markov chain has reached equilibrium. Similarly, once equlibrium has been reached, parameter samples that are drawn in quick succession will be correlated, as the Markov chain explores only slowly the parameter space. Therefore, in order to obtain many independent samples from the stationary distribution, it is important to ``thin'' the samples made by storing samples on only a small fraction of iterations, in order to ensure samples are taken from the whole parameter space.    

\section{Thesis Objectives}
This thesis describes the development of software for the analysis of fluorescence data. We implement and rigorously evaluate standard algorithms for the analysis of smFRET data. We then describe the implementation and evaluation of novel techniques for the analysis ofsmFRET data using sampling-based probabilistic inference. The primary objectives of this thesis are as follows. 

XXX

Each chapter in this thesis is presented in a stand-alone manner, to accurately reflect their relative independence. In each chapter, we first provide a more detailed overview of the specific context within which the research was performed. We then introduce any required theoretical concepts and experimental techniques, before presenting the relevant results and appropriate conclusion.


